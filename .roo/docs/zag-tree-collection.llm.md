# Zag.js TreeCollection API

A generic, immutable utility for managing and querying tree-like data structures.

---

## Core Concepts

-   **Immutability**: All mutation methods (`insert`, `remove`, `move`, etc.) are pure functions. They return a new `TreeCollection` instance and do not modify the original.
-   **Nodes (`<T>`)**: The tree is generic. Nodes can be any object shape. Access to children and properties is handled via accessor functions provided during instantiation.
-   **IndexPath (`number[]`)**: A zero-based path from the root to a specific node, representing the indices at each level of the tree. Example: `[0, 1, 2]` refers to the 3rd child of the 2nd child of the 1st child of the root.
-   **Value (`string`)**: A unique string identifier for a node, derived via the `nodeToValue` accessor. Used for most lookup operations.

---

## Instantiation

### `new TreeCollection(options)`

Creates a new tree collection from a root node object.

-   **`options`**: `TreeCollectionOptions<T>`
    -   `rootNode`: `T` - The root object of your tree.
    -   `nodeToValue?`: `(node: T) => string` - Function to get a node's unique value.
    -   `nodeToString?`: `(node: T) => string` - Function to get a node's string representation (for display).
    -   `nodeToChildren?`: `(node: T) => T[]` - Function to get a node's children array.
    -   `isNodeDisabled?`: `(node: T) => boolean` - Function to check if a node is disabled.

**Example:**
```typescript
const root = {
  value: 'root',
  children: [{ value: 'child1' }]
};
const collection = new TreeCollection({ rootNode: root });
```

### `filePathToTree(paths)`

Creates a tree collection from an array of file-path-like strings.

-   **`paths`**: `string[]` - An array of strings where `/` denotes hierarchy.

**Example:**
```typescript
const paths = ['docs/guide.md', 'docs/api/index.md', 'about.md'];
const fileTree = filePathToTree(paths);
```

### `flattenedToTree(nodes)`

Deserializes a flattened array of nodes back into a tree collection. Useful for reconstructing a tree from a saved state.

-   **`nodes`**: `Array<FlatTreeNode<T>>` - A flat array representing the tree, typically generated by `collection.flatten()`.

---

## API Reference

### Node Accessors & Information

#### `getNodeChildren(node)`
- **Signature**: `getNodeChildren(node: T): T[]`
- **Description**: Gets the children of a given node.
- **Parameters**:
    - `node`: `T` - The node to get the children of.
- **Returns**: `T[]` - An array of child nodes.

#### `getNodeValue(node)`
- **Signature**: `getNodeValue(node: T): string`
- **Description**: Gets the unique string value of a given node.
- **Parameters**:
    - `node`: `T` - The node to get the value of.
- **Returns**: `string` - The unique value.

#### `getNodeDisabled(node)`
- **Signature**: `getNodeDisabled(node: T): boolean`
- **Description**: Checks if a given node is disabled.
- **Parameters**:
    - `node`: `T` - The node to check.
- **Returns**: `boolean` - `true` if the node is disabled.

#### `getDepth(value)`
- **Signature**: `getDepth(value: string): number`
- **Description**: Gets the depth of a node (distance from the root). The root's depth is 0.
- **Parameters**:
    - `value`: `string` - The value of the node.
- **Returns**: `number` - The depth of the node.

#### `isBranchNode(node)`
- **Signature**: `isBranchNode(node: T): boolean`
- **Description**: Checks if a node is a branch (has children).
- **Parameters**:
    - `node`: `T` - The node to check.
- **Returns**: `boolean` - `true` if the node has children.

#### `isRootNode(node)`
- **Signature**: `isRootNode(node: T): boolean`
- **Description**: Checks if a given node is the root node of the collection.
- **Parameters**:
    - `node`: `T` - The node to check.
- **Returns**: `boolean` - `true` if the node is the root.

### Traversal & Searching

#### `at(indexPath)`
- **Signature**: `at(indexPath: IndexPath): T | undefined`
- **Description**: Retrieves the node at a specific `IndexPath`.
- **Parameters**:
    - `indexPath`: `IndexPath` - The path to the node.
- **Returns**: `T | undefined` - The node at the path, or `undefined` if not found.
- **Example**: `collection.at([0, 1])`

#### `findNode(value)`
- **Signature**: `findNode(value: string): T | undefined`
- **Description**: Finds the first node that matches the given value.
- **Parameters**:
    - `value`: `string` - The value of the node to find.
- **Returns**: `T | undefined` - The found node, or `undefined`.

#### `getFirstNode()`
- **Signature**: `getFirstNode(): T | undefined`
- **Description**: Gets the first enabled descendant node in the tree.
- **Returns**: `T | undefined` - The first enabled node.

#### `getLastNode()`
- **Signature**: `getLastNode(): T | undefined`
- **Description**: Gets the last enabled top-level node in the tree.
- **Returns**: `T | undefined` - The last enabled node.

#### `getNextNode(value)`
- **Signature**: `getNextNode(value: string): T | undefined`
- **Description**: Gets the next enabled node in the tree in traversal order.
- **Parameters**:
    - `value`: `string` - The value of the current node.
- **Returns**: `T | undefined` - The next enabled node.

#### `getPreviousNode(value)`
- **Signature**: `getPreviousNode(value: string): T | undefined`
- **Description**: Gets the previous enabled node in the tree in traversal order.
- **Parameters**:
    - `value`: `string` - The value of the current node.
- **Returns**: `T | undefined` - The previous enabled node.

#### `getParentNode(valueOrIndexPath)`
- **Signature**: `getParentNode(valueOrIndexPath: string | IndexPath): T | undefined`
- **Description**: Gets the parent of a given node.
- **Parameters**:
    - `valueOrIndexPath`: `string | IndexPath` - The value or `IndexPath` of the child node.
- **Returns**: `T | undefined` - The parent node.

#### `getDescendantNodes(valueOrIndexPath)`
- **Signature**: `getDescendantNodes(valueOrIndexPath: string | IndexPath): T[]`
- **Description**: Gets all descendant nodes of a given parent node.
- **Parameters**:
    - `valueOrIndexPath`: `string | IndexPath` - The value or `IndexPath` of the parent node.
- **Returns**: `T[]` - An array of descendant nodes.

#### `getNextSibling(indexPath)`
- **Signature**: `getNextSibling(indexPath: IndexPath): T | undefined`
- **Description**: Gets the next enabled sibling of the node at the given path.
- **Parameters**:
    - `indexPath`: `IndexPath` - The path of the current node.
- **Returns**: `T | undefined` - The next sibling node.

#### `getPreviousSibling(indexPath)`
- **Signature**: `getPreviousSibling(indexPath: IndexPath): T | undefined`
- **Description**: Gets the previous enabled sibling of the node at the given path.
- **Parameters**:
    - `indexPath`: `IndexPath` - The path of the current node.
- **Returns**: `T | undefined` - The previous sibling node.

### Path & Value Conversion

#### `getIndexPath(value)`
- **Signature**: `getIndexPath(value: string): IndexPath | undefined`
- **Description**: Gets the `IndexPath` for a node with the given value.
- **Parameters**:
    - `value`: `string` - The value of the node.
- **Returns**: `IndexPath | undefined` - The `IndexPath` of the node.

#### `getValue(indexPath)`
- **Signature**: `getValue(indexPath: IndexPath): string | undefined`
- **Description**: Gets the value of the node at a given `IndexPath`.
- **Parameters**:
    - `indexPath`: `IndexPath` - The path of the node.
- **Returns**: `string | undefined` - The value of the node.

#### `getValuePath(indexPath)`
- **Signature**: `getValuePath(indexPath: IndexPath | undefined): string[]`
- **Description**: Gets the array of values for each node along a given `IndexPath`.
- **Parameters**:
    - `indexPath`: `IndexPath` - The path to resolve.
- **Returns**: `string[]` - An array of values from the root to the node.

### Immutable Mutations

#### `insertAfter(indexPath, nodes)`
- **Signature**: `insertAfter(indexPath: IndexPath, nodes: T[]): TreeCollection<T> | undefined`
- **Description**: Returns a new collection with nodes inserted after the specified path.
- **Parameters**:
    - `indexPath`: `IndexPath` - The path to insert after.
    - `nodes`: `T[]` - An array of nodes to insert.
- **Returns**: `TreeCollection<T> | undefined` - A new collection with the inserted nodes.

#### `insertBefore(indexPath, nodes)`
- **Signature**: `insertBefore(indexPath: IndexPath, nodes: T[]): TreeCollection<T> | undefined`
- **Description**: Returns a new collection with nodes inserted before the specified path.
- **Parameters**:
    - `indexPath`: `IndexPath` - The path to insert before.
    - `nodes`: `T[]` - An array of nodes to insert.
- **Returns**: `TreeCollection<T> | undefined` - A new collection with the inserted nodes.

#### `remove(indexPaths)`
- **Signature**: `remove(indexPaths: IndexPath[]): TreeCollection<T>`
- **Description**: Returns a new collection with the nodes at the specified paths removed.
- **Parameters**:
    - `indexPaths`: `IndexPath[]` - An array of paths to the nodes to remove.
- **Returns**: `TreeCollection<T>` - A new collection without the specified nodes.

#### `move(fromIndexPaths, toIndexPath)`
- **Signature**: `move(fromIndexPaths: IndexPath[], toIndexPath: IndexPath): TreeCollection<T>`
- **Description**: Returns a new collection with nodes moved from specified paths to a new location.
- **Parameters**:
    - `fromIndexPaths`: `IndexPath[]` - An array of paths to the nodes to move.
    - `toIndexPath`: `IndexPath` - The destination path.
- **Returns**: `TreeCollection<T>` - A new collection with the moved nodes.

#### `replace(indexPath, node)`
- **Signature**: `replace(indexPath: IndexPath, node: T): TreeCollection<T>`
- **Description**: Returns a new collection with the node at the specified path replaced.
- **Parameters**:
    - `indexPath`: `IndexPath` - The path of the node to replace.
    - `node`: `T` - The new node.
- **Returns**: `TreeCollection<T>` - A new collection with the replaced node.

#### `filter(predicate)`
- **Signature**: `filter(predicate: (node: T, indexPath: IndexPath) => boolean): TreeCollection<T>`
- **Description**: Returns a new collection containing only nodes that match the predicate, preserving the tree structure.
- **Parameters**:
    - `predicate`: `(node: T, indexPath: IndexPath) => boolean` - A function that returns `true` for nodes to keep.
- **Returns**: `TreeCollection<T>` - A new, filtered collection.

### Utilities

#### `sort(values)`
- **Signature**: `sort(values: string[]): string[]`
- **Description**: Sorts an array of node values based on their position in the tree.
- **Parameters**:
    - `values`: `string[]` - An array of node values to sort.
- **Returns**: `string[]` - The sorted array of values.

#### `flatten()`
- **Signature**: `flatten(): Array<FlatTreeNode<T>>`
- **Description**: Flattens the tree into an array of nodes, with metadata (`_parent`, `_children`, `_index`) for reconstruction.
- **Returns**: `Array<FlatTreeNode<T>>` - A flat array representing the tree.

#### `toJSON()`
- **Signature**: `toJSON(): string[]`
- **Description**: Returns an array of all node values in the tree.
- **Returns**: `string[]` - An array of values.

#### `isEqual(other)`
- **Signature**: `isEqual(other: TreeCollection<T>): boolean`
- **Description**: Checks if the current collection is deeply equal to another.
- **Parameters**:
    - `other`: `TreeCollection<T>` - The other collection to compare.
- **Returns**: `boolean` - `true` if the collections are equal.

#### `visit(options)`
- **Signature**: `visit(opts: TreeVisitOptions<T>)`
- **Description**: Performs a depth-first traversal of the tree, calling `onEnter` and `onLeave` for each node.
- **Parameters**:
    - `opts`: `TreeVisitOptions<T>` - Options including `onEnter` and `onLeave` callbacks.

---

## Type Definitions

-   **`IndexPath: number[]`**
    An array of numbers representing the path to a node from the root.

-   **`TreeNode: any`**
    The generic type for a node. Can be any object.

-   **`TreeCollectionMethods<T>`**
    An interface for functions that provide access to node properties.
    -   `isNodeDisabled(node: T): boolean`
    -   `nodeToValue(node: T): string`
    -   `nodeToString(node: T): string`
    -   `nodeToChildren(node: T): any[]`
    -   `nodeToChildrenCount(node: T): number | undefined`

-   **`TreeCollectionOptions<T>`**
    The options object for the `TreeCollection` constructor, extending `TreeCollectionMethods`.
    -   `rootNode: T`

-   **`FlatTreeNode<T>`**
    A node in a flattened tree, with added metadata for reconstruction.
    -   `_children: number[] | undefined` (indices of children)
    -   `_parent: number | undefined` (index of parent)
    -   `_index: number` (own index in the flat array)